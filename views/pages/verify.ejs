<!DOCTYPE html>
<html>
<head>
  <meta charset="UTF-8" />
  <title>Email Verification</title>
  <script type="module">
    import { initializeApp } from "https://www.gstatic.com/firebasejs/10.11.0/firebase-app.js";
    import { getAuth, applyActionCode } from "https://www.gstatic.com/firebasejs/10.11.0/firebase-auth.js";

    const firebaseConfig = {
      apiKey: "AIzaSyBKjg5iRL-5xs2LcoRf-KiGg0avlqKBdKw",
      authDomain: "debuild-c745e.firebaseapp.com",
      projectId: "debuild-c745e",
      storageBucket: "debuild-c745e.appspot.com",
      messagingSenderId: "1042044600830",
      appId: "1:1042044600830:web:b2c79a700dca8e14d280af",
    };

    const app = initializeApp(firebaseConfig);
    const auth = getAuth(app);

    window.addEventListener("DOMContentLoaded", async () => {
      const statusEl = document.getElementById("status");
      const oobCode = "<%= oobCode %>";
      const mode = "<%= mode %>";

      if (mode !== "verifyEmail" || !oobCode) {
        statusEl.textContent = "Invalid verification link.";
        return;
      }

      try {
        await applyActionCode(auth, oobCode);
        statusEl.textContent = "✅ Your email has been verified successfully.";
        // Optional: redirect or call backend to update Firestore
      } catch (error) {
        statusEl.textContent = "❌ Verification failed: " + error.message;
      }
    });
  </script>
</head>
<body>
  <h1>Email Verification</h1>
  <p id="status">Verifying...</p>
  <a href="/">Go to Homepage</a>
</body>
</html>
